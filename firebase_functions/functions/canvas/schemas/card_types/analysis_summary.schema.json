{
  "$id": "https://myon.dev/schemas/canvas/card_types/analysis_summary.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "additionalProperties": false,
  "required": ["headline", "insights", "recommendations", "data_quality"],
  "properties": {
    "headline": {
      "type": "string",
      "description": "Primary summary statement, e.g., 'Strong progress on upper body, back lagging'"
    },
    "period": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "weeks": { "type": "integer", "minimum": 1, "maximum": 52 },
        "start": { "type": "string", "format": "date" },
        "end": { "type": "string", "format": "date" }
      }
    },
    "insights": {
      "type": "array",
      "minItems": 1,
      "maxItems": 10,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["category", "signal", "trend"],
        "properties": {
          "category": {
            "type": "string",
            "enum": ["progressive_overload", "volume", "frequency", "laggard", "consistency", "goal_alignment"]
          },
          "signal": {
            "type": "string",
            "description": "Human-readable insight, e.g., 'Squat e1RM up 5% over 6 weeks'"
          },
          "metric_key": {
            "type": "string",
            "description": "Reference to the metric used, e.g., 'e1rm_squat', 'volume_back'"
          },
          "value": {
            "type": ["number", "string", "null"],
            "description": "The metric value if applicable"
          },
          "baseline": {
            "type": ["number", "null"],
            "description": "Comparison baseline value if applicable"
          },
          "trend": {
            "type": "string",
            "enum": ["improving", "stable", "declining", "insufficient_data"]
          },
          "confidence": {
            "type": "string",
            "enum": ["high", "medium", "low"]
          }
        }
      }
    },
    "recommendations": {
      "type": "array",
      "minItems": 1,
      "maxItems": 5,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["priority", "action", "rationale"],
        "properties": {
          "priority": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5,
            "description": "1 = highest priority"
          },
          "action": {
            "type": "string",
            "description": "Actionable change, e.g., 'Increase weekly back sets from 12 to 15'"
          },
          "rationale": {
            "type": "string",
            "description": "Evidence-based reason, e.g., 'Back volume 23% below target with flat e1RM'"
          },
          "category": {
            "type": "string",
            "enum": ["volume", "frequency", "exercise_selection", "progression", "recovery"]
          },
          "apply_payload": {
            "type": "object",
            "description": "Structured payload for Planner handoff (TODO: define schema)",
            "additionalProperties": true
          }
        }
      }
    },
    "data_quality": {
      "type": "object",
      "additionalProperties": false,
      "required": ["weeks_with_data", "confidence"],
      "properties": {
        "weeks_with_data": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of weeks with workout data in the analysis window"
        },
        "workouts_analyzed": {
          "type": "integer",
          "minimum": 0,
          "description": "Total workouts analyzed"
        },
        "confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "Overall confidence in analysis: high (8+ weeks), medium (4-7), low (<4)"
        },
        "caveats": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Any data quality warnings, e.g., 'Missing 2 weeks in analysis window'"
        }
      }
    },
    "visualization_refs": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Card IDs of associated visualization cards (set by backend)"
    }
  }
}
