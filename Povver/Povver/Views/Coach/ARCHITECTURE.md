# Coach Views — Module Architecture

Views supporting the Coach tab beyond the main canvas chat.

## File Inventory

| File | Purpose |
|------|---------|
| `AllConversationsSheet.swift` | Full conversation history sheet. Presented from CoachTabView "See all" button. Paginated Firestore query (20 per page) on `canvases` collection, grouped by date (Today, Yesterday, This Week, or date label). Calls `onSelectCanvas` callback to navigate to a conversation. |

## Data Flow

```
CoachTabView
  ├── Inline: 3 recent canvases (from loadRecentCanvases, limit 5)
  │     └── Displays title ?? lastMessage ?? "General chat"
  └── "See all" button
        └── AllConversationsSheet
              ├── Queries: users/{uid}/canvases where status=active, ordered by updatedAt desc
              ├── Pagination: startAfter cursor, 20 per page
              ├── Groups: Today / Yesterday / This Week / MMM d
              └── onSelectCanvas(canvasId) → dismisses sheet → CoachTabView navigates
```

## Title Generation

Conversation titles are auto-generated by `stream-agent-normalized.js` (Firebase Function) after the first message exchange:
- Calls Gemini 2.0 Flash with the user's message to produce a 3-6 word title
- Writes `title` to both `canvases/{id}` and `conversations/{id}` root docs
- Fire-and-forget — title failure never breaks streaming
- iOS displays `title ?? lastMessage ?? "General chat"` (graceful fallback for old canvases)
